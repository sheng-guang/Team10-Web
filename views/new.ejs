<!DOCTYPE html>
<html>
<head>
    <title><%= title %></title>
    <script src="/socket.io/socket.io.js"></script>
    <link rel='stylesheet' href='/stylesheets/style.css'/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="/javascripts/DataBase.js" type="module"></script>
    <script src="/javascripts/index.js"></script>
    <script src="/javascripts/canvas.js"></script>
    <script src="/javascripts/story.js"></script>
    <script>
         async function addNewStory(ne){
            console.log("new story "+ne);
            return  await StoreStory(ne);
            // all.push(ne);
        }
        function  getDate(){
             let d=new Date();
             var re=d.getFullYear()+"-"+d.getMonth()+"-"+d.getDay();
             re+=" "+d.getHours()+":"+d.getMinutes();
             console.log(re);
            return re;
        }
        function send() {
             var ne={}
            ne.title=document.getElementById("title1").value;
            ne.picture=document.getElementById("img").src;
            ne.description=document.getElementById("description1").value;
            ne.author=document.getElementById("author1").value;
            ne.date=getDate()
            ne.t= Date.parse(new Date());
            console.log(ne.date);
            console.log(ne.t);
            addNewStory(ne).then(x=>{
                // ToHomePage();
            })
            .finally(()=>{
                ToHomePage();
            });

        }
        function  SendToServer(title,picture,description,author){
            axios.get('/upload', {
                params: {
                    "title": title,
                    "description":description,
                    "author":author
                }
            }) .then(response=> {
                console.log("===success  "+response)
            }) .catch(error=> {
                console.log("===error   "+error)
            });
        }
        function ToHomePage(){
            location.href="http://localhost:3000"
        }
        function imgChange(event){
            console.log(event.target.files)
            var file = event.target.files[0];
            var reader = new FileReader();
            reader.onload = function (e) {
                console.log(e.target.result);
                if ((e.target.result).includes('image'))
                {
                    document.getElementById("img").src=e.target.result;
                }
            }
            if (file) {
                reader.readAsDataURL(file);
            }
        }
    </script>
</head>
<body onload="init()">
<div id="initial_form" style="display: block">
    <h1>Create a new story</h1>
</div>

    <p>
        <input type="file" name="picBase64" id="picBase64" onchange="imgChange(event)" accept=".gif,.jpg,.jpeg,.png">
    </p>
    <h3>Please write the author, title, and description</h3>
    <p><label for="title1"> Image's title </label>
        <input type="text" id="title1" name="title">
    </p>
    <p>
        <label for="description1"> Description </label>
        <input type="text" id="description1" name="description">
    </p>
    <p>
        <label for="author1"> Author </label>
        <input type="text" id="author1" name="author">
    </p>

    <p>
        <input type="submit" onclick="send()" value="Submit" id="upload3">
    </p>
<div style="width: 100%;height: 500px">
    <img id="img" src="" height="100%">

</div>
</body>